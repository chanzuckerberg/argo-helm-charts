# Argo Helm Charts

This repository contains Helm charts that we use in ArgoCD / Argus.

The `stack` chart is the standard chart for used when deploying an Argus application.

### Running tests locally

1. `helm plugin install https://github.com/helm-unittest/helm-unittest.git`
2. run `make test` (or `make test-debug` to see the templates generated by the unit tests)
    - this can be run from the root directory to run tests for all charts
    - or from any helm chart directory to run tests just for that chart

### Testing an un-published chart in Argus

You can create a stack from a chart that has not been published.

Suppose you want to test some local changes of the stack helm chart in the `argus-example-app`. To do so you would:

1. Clone the `argus-example-app` repository
1. Change the `.infra/rdev/Chart.yaml` in the `argus-example-app` to point to the local directory
    - set the `repository` of the `stack` chart dependency to `file://<relative path to argo-helm-charts/stack/ directory>`
1. Run `helm dependency update` from a terminal in the `argus-example-app` repository
1. Create a new branch then commit and push the changes to the `argus-example-app` repository
    - This should include your changes to `.infra/rdev/Chart.yaml`, the newly created `.infra/rdev/Chart.lock`, and the `.infra/rdev/charts/stack-<X.Y.Z>.tgz` file
1. Create a PR in the `argus-example-app` repository and create a stack in Argus using the `stack` label on the PR

[Here is an example of the changes](https://github.com/chanzuckerberg/argus-example-app/pull/159/commits/3685595e8e7d31a49077de173a678817ac96de65)

NOTE: Do not merge `.infra/rdev/Chart.lock` or `.infra/rdev/charts/stack-<X.Y.Z>.tgz` into the main branch. These files should only be used for testing purposes.

## Code of Conduct

This project adheres to the Contributor Covenant [code of conduct](https://github.com/chanzuckerberg/.github/blob/master/CODE_OF_CONDUCT.md).
By participating, you are expected to uphold this code. 
Please report unacceptable behavior to [opensource@chanzuckerberg.com](mailto:opensource@chanzuckerberg.com).
