suite: test dashboards.yaml
templates:
  - dashboards.yaml

tests:
  - it: should render a GrafanaDashboard resource
    asserts:
      - hasDocuments:
          count: 20
      - isKind:
          of: GrafanaDashboard

  - it: should contain metadata
    asserts:
      - isNotEmpty:
          path: metadata.name

  - it: should have valid metadata
    asserts:
      - isNotEmpty:
          path: spec

  - it: should have datasources in loki-kubernetes-logs dashboard
    documentIndex: 0
    asserts:
      - isNotEmpty:
          path: spec.datasources
      - equal:
          path: spec.datasources[0].datasourceName
          value: "Loki"

  - it: should have an instance selector
    asserts:
      - isNotEmpty:
          path: spec.instanceSelector

  - it: should have a folder
    asserts:
      - isNotEmpty:
          path: spec.folder

  - it: should have an instance selector
    asserts:
      - isNotEmpty:
          path: spec.instanceSelector.matchLabels.name

  - it: should have multiple datasources in multi-datasource-example dashboard
    documentIndex: 19
    asserts:
      - equal:
          path: spec.datasources
          value:
            - inputName: "DS_PROMETHEUS"
              datasourceName: "Prometheus"
            - inputName: "DS_LOKI"
              datasourceName: "Loki"
      - lengthEqual:
          path: spec.datasources
          count: 2