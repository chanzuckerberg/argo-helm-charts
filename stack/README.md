# Argus stack helm chart

A Helm chart for deploying an Argus stack.

## Parameters

### Global parameters

| Name                      | Description                                                                | Value          |
| ------------------------- | -------------------------------------------------------------------------- | -------------- |
| `global.deploymentStage`  | Deployment stage (eg: rdev, staging, prod)                                 | `""`           |
| `global.replicaCount`     | Number of replicas                                                         | `1`            |
| `global.image.repository` | Image repository                                                           | `nginx`        |
| `global.image.pullPolicy` | Image pull policy                                                          | `IfNotPresent` |
| `global.image.tag`        | Image tag                                                                  | `latest`       |
| `global.command`          | Command to run in the primary container                                    | `[]`           |
| `global.args`             | Arguments to pass to the command in the primary container                  | `[]`           |
| `global.imagePullSecrets` | Image pull secrets                                                         | `[]`           |
| `global.nameOverride`     | Name to prefix the K8s resources with, combined with the stack name prefix | `""`           |
| `global.fullnameOverride` | Name to prefix the K8s resources with, replaces the stack name prefix      | `""`           |
| `global.dnsPolicy`        | DNS policy for the pod                                                     | `ClusterFirst` |
| `global.restartPolicy`    | Restart policy for the pod                                                 | `Always`       |

### global.livenessProbe Liveness probe configuration

| Name                                    | Description                                              | Value |
| --------------------------------------- | -------------------------------------------------------- | ----- |
| `global.livenessProbe.failureThreshold` | Number of failures before the probe is considered failed | `3`   |

### global.livenessProbe.httpGet HTTP probe configuration (exec & tcpSocket are also available)

| Name                                       | Description                                                                           | Value  |
| ------------------------------------------ | ------------------------------------------------------------------------------------- | ------ |
| `global.livenessProbe.httpGet.path`        | Path to probe                                                                         | `/`    |
| `global.livenessProbe.httpGet.port`        | Port to probe                                                                         | `http` |
| `global.livenessProbe.httpGet.scheme`      | Scheme to use                                                                         | `HTTP` |
| `global.livenessProbe.periodSeconds`       | How often to perform the probe                                                        | `10`   |
| `global.livenessProbe.successThreshold`    | Number of successes before the probe is considered successful                         | `1`    |
| `global.livenessProbe.timeoutSeconds`      | Timeout for the probe                                                                 | `1`    |
| `global.livenessProbe.initialDelaySeconds` | Number of seconds after the container has started before the probe is first initiated | `30`   |

### global.readinessProbe Readiness probe configuration

| Name                                     | Description                                              | Value |
| ---------------------------------------- | -------------------------------------------------------- | ----- |
| `global.readinessProbe.failureThreshold` | Number of failures before the probe is considered failed | `3`   |

### global.readinessProbe.httpGet HTTP probe configuration (exec & tcpSocket are also available)

| Name                                        | Description                                                                           | Value  |
| ------------------------------------------- | ------------------------------------------------------------------------------------- | ------ |
| `global.readinessProbe.httpGet.path`        | Path to probe                                                                         | `/`    |
| `global.readinessProbe.httpGet.port`        | Port to probe                                                                         | `http` |
| `global.readinessProbe.httpGet.scheme`      | Scheme to use                                                                         | `HTTP` |
| `global.readinessProbe.periodSeconds`       | How often to perform the probe                                                        | `10`   |
| `global.readinessProbe.successThreshold`    | Number of successes before the probe is considered successful                         | `1`    |
| `global.readinessProbe.timeoutSeconds`      | Timeout for the probe                                                                 | `1`    |
| `global.readinessProbe.initialDelaySeconds` | Number of seconds after the container has started before the probe is first initiated | `30`   |

### global.startupProbe Startup probe configuration

| Name                                      | Description                                                                                                                                 | Value          |
| ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| `global.startupProbe.enabled`             | Enable the startup probe                                                                                                                    | `false`        |
| `global.startupProbe.failureThreshold`    | Number of failures before the probe is considered failed                                                                                    | `3`            |
| `global.startupProbe.successThreshold`    | Number of successes before the probe is considered successful                                                                               | `1`            |
| `global.startupProbe.initialDelaySeconds` | Number of seconds after the container has started before the probe is first initiated                                                       | `0`            |
| `global.startupProbe.timeoutSeconds`      | Timeout for the probe                                                                                                                       | `1`            |
| `global.startupProbe.periodSeconds`       | How often to perform the probe                                                                                                              | `10`           |
| `global.startupProbe.exec.command`        | Command to run in the probe                                                                                                                 | `["ps","-ef"]` |
| `global.progressDeadlineSeconds`          | the number of seconds the Deployment controller waits before indicating (in the Deployment status) that the Deployment progress has stalled | `600`          |
| `global.resources.limits.cpu`             | CPU limit                                                                                                                                   | `1`            |
| `global.resources.limits.memory`          | Memory limit                                                                                                                                | `1Gi`          |
| `global.resources.requests.cpu`           | CPU request                                                                                                                                 | `100m`         |
| `global.resources.requests.memory`        | Memory request                                                                                                                              | `128Mi`        |
| `global.service.type`                     | Service type                                                                                                                                | `ClusterIP`    |
| `global.service.port`                     | Service port                                                                                                                                | `80`           |
| `global.initContainers`                   | List of init containers                                                                                                                     | `[]`           |
| `global.sidecars`                         | List of sidecars                                                                                                                            | `[]`           |
| `global.annotations`                      | Global annotations to add to all resources                                                                                                  | `{}`           |
| `global.podLabels`                        | Global labels to add to all pods                                                                                                            | `{}`           |
| `global.serviceAccount.create`            | Specifies whether a service account should be created                                                                                       | `false`        |
| `global.serviceAccount.automount`         | Specifies whether to automatically mount a ServiceAccount's API credentials                                                                 | `true`         |
| `global.serviceAccount.annotations`       | Annotations to add to the service account                                                                                                   | `{}`           |
| `global.serviceAccount.name`              | Name of the service account to use (if not set and create is true, a name is generated using the fullname template)                         | `""`           |
| `global.podSecurityContext`               | Pod security context                                                                                                                        | `{}`           |
| `global.securityContext`                  | Security context                                                                                                                            | `{}`           |
| `global.shareProcessNamespace`            | Share process namespace                                                                                                                     | `false`        |

### global.ingress Ingress configuration

| Name                       | Description        | Value                 |
| -------------------------- | ------------------ | --------------------- |
| `global.ingress.enabled`   | Enable ingress     | `true`                |
| `global.ingress.className` | Ingress class name | `nginx`               |
| `global.ingress.host`      | Ingress host       | `chart-example.local` |

### global.ingress.paths List of ingress paths

| Name                                                                            | Description                                                                                                                    | Value                                                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `global.ingress.paths[0].path`                                                  | Ingress path                                                                                                                   | `/`                                                                                                                                                                                                                                                                                                                                                          |
| `global.ingress.paths[0].pathType`                                              | Ingress path type                                                                                                              | `Prefix`                                                                                                                                                                                                                                                                                                                                                     |
| `global.ingress.rules`                                                          | List of ingress rules                                                                                                          | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.ingress.oidcProtected`                                                  | Enable OIDC protection                                                                                                         | `false`                                                                                                                                                                                                                                                                                                                                                      |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/proxy-connect-timeout`  | Nginx ingress proxy connect timeout                                                                                            | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/proxy-send-timeout`     | Nginx ingress proxy send timeout                                                                                               | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/proxy-read-timeout`     | Nginx ingress proxy read timeout                                                                                               | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/affinity`               | Nginx ingress affinity                                                                                                         | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/session-cookie-name`    | Nginx ingress session cookie name                                                                                              | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.annotations.nginx.ingress.kubernetes.io/session-cookie-max-age` | Nginx ingress session cookie max age                                                                                           | `{"nginx.ingress.kubernetes.io/proxy-connect-timeout":"60","nginx.ingress.kubernetes.io/proxy-send-timeout":"60","nginx.ingress.kubernetes.io/proxy-read-timeout":"60","nginx.ingress.kubernetes.io/affinity":"cookie","nginx.ingress.kubernetes.io/session-cookie-name":"argus_sticky_session","nginx.ingress.kubernetes.io/session-cookie-max-age":"600"}` |
| `global.ingress.tls`                                                            | List of ingress TLS configurations                                                                                             | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.nodeSelector.kubernetes.io/arch`                                        | Node selector for architecture                                                                                                 | `arm64`                                                                                                                                                                                                                                                                                                                                                      |
| `global.podAnnotations.linkerd.io/inject`                                       | Linkerd injection annotation                                                                                                   | `enabled`                                                                                                                                                                                                                                                                                                                                                    |
| `global.podAnnotations.config.linkerd.io/skip-outbound-ports`                   | Linkerd skip outbound ports annotation                                                                                         | `3306,5432,6379,9300,11211,4444,4567,4568,587,25,2525,465,2465`                                                                                                                                                                                                                                                                                              |
| `global.autoscaling.enabled`                                                    | Enable autoscaling                                                                                                             | `true`                                                                                                                                                                                                                                                                                                                                                       |
| `global.autoscaling.minReplicas`                                                | Minimum number of replicas                                                                                                     | `1`                                                                                                                                                                                                                                                                                                                                                          |
| `global.autoscaling.maxReplicas`                                                | Maximum number of replicas                                                                                                     | `10`                                                                                                                                                                                                                                                                                                                                                         |
| `global.autoscaling.targetCPUUtilizationPercentage`                             | Target CPU utilization percentage                                                                                              | `80`                                                                                                                                                                                                                                                                                                                                                         |
| `global.autoscaling.targetMemoryUtilizationPercentage`                          | Target memory utilization percentage                                                                                           | `80`                                                                                                                                                                                                                                                                                                                                                         |
| `global.volumes`                                                                | Additional volumes on the output Deployment definition                                                                         | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.volumeMounts`                                                           | Additional volume mounts on the output Deployment definition                                                                   | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.tolerations`                                                            | Tolerations for the pod                                                                                                        | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.affinity`                                                               | Affinity for the pod                                                                                                           | `{}`                                                                                                                                                                                                                                                                                                                                                         |
| `global.topologySpreadConstraints`                                              | Topology spread constraints for the pod                                                                                        | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.env[0].name`                                                            | Environment variable name                                                                                                      | `__ARGUS`                                                                                                                                                                                                                                                                                                                                                    |
| `global.env[0].value`                                                           | Environment variable value                                                                                                     | `true`                                                                                                                                                                                                                                                                                                                                                       |
| `global.envFrom`                                                                | Environment variables from configmaps or secrets                                                                               | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.persistence.enabled`                                                    | Enable persistence                                                                                                             | `false`                                                                                                                                                                                                                                                                                                                                                      |
| `global.persistence.pvc.accessModes`                                            | Access modes                                                                                                                   | `["ReadWriteOnce"]`                                                                                                                                                                                                                                                                                                                                          |
| `global.persistence.pvc.resources.requests.storage`                             | Storage resource request                                                                                                       | `8Gi`                                                                                                                                                                                                                                                                                                                                                        |
| `global.persistence.pvc.storageClassName`                                       | Storage class name                                                                                                             | `default`                                                                                                                                                                                                                                                                                                                                                    |
| `global.persistence.existingClaim`                                              | Existing PVC name                                                                                                              | `""`                                                                                                                                                                                                                                                                                                                                                         |
| `global.persistence.mountPath`                                                  | Mount path for the PVC                                                                                                         | `""`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.enabled`                                                      | Enable OIDC proxy                                                                                                              | `false`                                                                                                                                                                                                                                                                                                                                                      |
| `global.oidcProxy.image.repository`                                             | Image repository                                                                                                               | `quay.io/oauth2-proxy/oauth2-proxy`                                                                                                                                                                                                                                                                                                                          |
| `global.oidcProxy.image.tag`                                                    | Image tag                                                                                                                      | `v7.6.0`                                                                                                                                                                                                                                                                                                                                                     |
| `global.oidcProxy.replicaCount`                                                 | Number of replicas                                                                                                             | `3`                                                                                                                                                                                                                                                                                                                                                          |
| `global.oidcProxy.additionalSecrets`                                            | Additional secrets to mount                                                                                                    | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.additionalHeaders`                                            | Additional headers to add                                                                                                      | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.annotations`                                                  | Annotations to add to the OIDC proxy                                                                                           | `{}`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.volumeMounts`                                                 | Volume mounts for the OIDC proxy                                                                                               | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.skipAuth`                                                     | Paths to skip authentication                                                                                                   | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.cookieRefresh`                                                | Refresh tokens and cookies after this period                                                                                   | `59m`                                                                                                                                                                                                                                                                                                                                                        |
| `global.oidcProxy.extraArgs`                                                    | Extra arguments to pass to the OIDC proxy                                                                                      | `[]`                                                                                                                                                                                                                                                                                                                                                         |
| `global.oidcProxy.resources.limits.cpu`                                         | CPU limit                                                                                                                      | `2`                                                                                                                                                                                                                                                                                                                                                          |
| `global.oidcProxy.resources.limits.memory`                                      | Memory limit                                                                                                                   | `4Gi`                                                                                                                                                                                                                                                                                                                                                        |
| `global.oidcProxy.resources.requests.cpu`                                       | CPU request                                                                                                                    | `2`                                                                                                                                                                                                                                                                                                                                                          |
| `global.oidcProxy.resources.requests.memory`                                    | Memory request                                                                                                                 | `4Gi`                                                                                                                                                                                                                                                                                                                                                        |
| `services`                                                                      | Services to deploy, all values in the above global section are inherited by the services and each service can override them    | `{}`                                                                                                                                                                                                                                                                                                                                                         |
| `cronJobs`                                                                      | Cron jobs to deploy, all values in the above global section are inherited by the cron jobs and each cron job can override them | `{}`                                                                                                                                                                                                                                                                                                                                                         |
| `jobs`                                                                          | Jobs to deploy, all values in the above global section are inherited by the jobs and each job can override them                | `{}`                                                                                                                                                                                                                                                                                                                                                         |
