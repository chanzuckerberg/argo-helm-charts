{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "argo.helm.charts/stack",
  "title": "stack",
  "type": "object",
  "properties": {
    "argus-config": {
      "description": "Allows values for the argus-config Helm chart",
      "type": "object"
    },
    "cronJobs": {
      "description": "Cron jobs to deploy",
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "$ref": "#/properties/global",
          "type": "object"
        }
      }
    },
    "global": {
      "description": "Global configuration for the stack - this serves as the default configuration for all services/jobs/cronjobs",
      "type": "object",
      "properties": {
        "affinity": {
          "description": "Affinity for the pod",
          "type": "object"
        },
        "annotations": {
          "description": "Global annotations to add to all resources",
          "type": "object"
        },
        "appContext": {
          "type": "object",
          "properties": {
            "envContextConfigMapName": {
              "type": "string"
            },
            "stackContextConfigMapName": {
              "type": "string"
            }
          }
        },
        "appSecrets": {
          "type": "object",
          "properties": {
            "clusterSecret": {
              "type": "object",
              "properties": {
                "secretKey": {
                  "type": "string"
                },
                "secretName": {
                  "type": "string"
                }
              }
            },
            "envSecret": {
              "type": "object",
              "properties": {
                "secretKey": {
                  "type": "string"
                },
                "secretName": {
                  "type": "string"
                }
              }
            },
            "stackSecret": {
              "type": "object",
              "properties": {
                "secretKey": {
                  "type": "string"
                },
                "secretName": {
                  "type": "string"
                }
              }
            }
          }
        },
        "args": {
          "description": "Arguments to pass to the command in the primary container",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "autoscaling": {
          "description": "Autoscaling configuration",
          "type": "object",
          "properties": {
            "enabled": {
              "description": "Enable autoscaling",
              "type": "boolean"
            },
            "maxReplicas": {
              "description": "Maximum number of replicas",
              "type": "integer"
            },
            "minReplicas": {
              "description": "Minimum number of replicas",
              "type": "integer"
            },
            "targetCPUUtilizationPercentage": {
              "description": "Target CPU utilization percentage",
              "type": "integer"
            },
            "targetMemoryUtilizationPercentage": {
              "description": "Target memory utilization percentage",
              "type": "integer"
            }
          }
        },
        "command": {
          "description": "Command to run in the primary container",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "deploymentStage": {
          "description": "Deployment stage",
          "type": "string"
        },
        "dnsPolicy": {
          "description": "DNS policy for the pod",
          "type": "string",
          "enum": [
            "ClusterFirst",
            "Default",
            "None"
          ]
        },
        "env": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "value": {
                "type": "string"
              }
            }
          }
        },
        "envFrom": {
          "description": "Environment variables from configmaps or secrets",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "configMapRef": {
                "type": "object"
              },
              "prefix": {
                "type": "string"
              },
              "secretRef": {
                "type": "object"
              }
            }
          }
        },
        "fullnameOverride": {
          "description": "Name to prefix the K8s resources with, replaces the stack name prefix",
          "type": "string"
        },
        "image": {
          "type": "object",
          "properties": {
            "pullPolicy": {
              "description": "Image pull policy",
              "type": "string",
              "enum": [
                "Always",
                "IfNotPresent",
                "Never"
              ]
            },
            "repository": {
              "description": "Image repository",
              "type": "string"
            },
            "tag": {
              "description": "Image tag",
              "type": "string"
            }
          }
        },
        "imagePullSecrets": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ingress": {
          "description": "Ingress configuration",
          "type": "object",
          "properties": {
            "annotations": {
              "type": "object",
              "properties": {
                "nginx.ingress.kubernetes.io/affinity": {
                  "type": "string"
                },
                "nginx.ingress.kubernetes.io/proxy-connect-timeout": {
                  "type": "string"
                },
                "nginx.ingress.kubernetes.io/proxy-read-timeout": {
                  "type": "string"
                },
                "nginx.ingress.kubernetes.io/proxy-send-timeout": {
                  "type": "string"
                },
                "nginx.ingress.kubernetes.io/session-cookie-max-age": {
                  "type": "string"
                },
                "nginx.ingress.kubernetes.io/session-cookie-name": {
                  "type": "string"
                }
              }
            },
            "className": {
              "description": "Ingress class name",
              "type": "string"
            },
            "enabled": {
              "description": "Enable ingress",
              "type": "boolean"
            },
            "host": {
              "description": "Ingress host",
              "type": "string"
            },
            "oidcProtected": {
              "description": "Enable OIDC protection",
              "type": "boolean"
            },
            "paths": {
              "description": "List of ingress paths",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "description": "Ingress path",
                    "type": "string"
                  },
                  "pathType": {
                    "description": "Ingress path type",
                    "type": "string"
                  }
                }
              }
            },
            "rules": {
              "description": "List of ingress rules",
              "type": "array"
            },
            "tls": {
              "description": "List of ingress TLS configurations",
              "type": "array"
            }
          }
        },
        "initContainers": {
          "description": "List of init containers",
          "type": "array"
        },
        "livenessProbe": {
          "description": "Liveness probe configuration",
          "type": "object",
          "properties": {
            "failureThreshold": {
              "description": "Number of failures before the probe is considered failed",
              "type": "number"
            },
            "httpGet": {
              "description": "HTTP probe configuration (exec \u0026 tcpSocket are also available)",
              "type": "object",
              "properties": {
                "path": {
                  "description": "Path to probe",
                  "type": "string"
                },
                "port": {
                  "description": "Port to probe",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "number"
                    }
                  ]
                },
                "scheme": {
                  "description": "Scheme to use",
                  "type": "string"
                }
              }
            },
            "initialDelaySeconds": {
              "description": "Number of seconds after the container has started before the probe is first initiated",
              "type": "number"
            },
            "periodSeconds": {
              "description": "How often to perform the probe",
              "type": "number"
            },
            "successThreshold": {
              "description": "Number of successes before the probe is considered successful",
              "type": "number"
            },
            "timeoutSeconds": {
              "description": "Timeout for the probe",
              "type": "number"
            }
          }
        },
        "nameOverride": {
          "description": "Name to prefix the K8s resources with, combined with the stack name prefix",
          "type": "string"
        },
        "nodeSelector": {
          "type": "object",
          "properties": {
            "kubernetes.io/arch": {
              "description": "Node selector for architecture",
              "type": "string"
            }
          }
        },
        "oidcProxy": {
          "type": "object",
          "properties": {
            "additionalHeaders": {
              "description": "Additional headers to add",
              "type": "array"
            },
            "additionalSecrets": {
              "description": "Additional secrets to mount",
              "type": "array"
            },
            "annotations": {
              "description": "Annotations to add to the OIDC proxy",
              "type": "object"
            },
            "cookieRefresh": {
              "description": "Refresh tokens and cookies after this period",
              "type": "string"
            },
            "enabled": {
              "description": "Enable OIDC proxy",
              "type": "boolean"
            },
            "extraArgs": {
              "description": "Extra arguments to pass to the OIDC proxy",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "image": {
              "type": "object",
              "properties": {
                "repository": {
                  "description": "Image repository",
                  "type": "string"
                },
                "tag": {
                  "description": "Image tag",
                  "type": "string"
                }
              }
            },
            "replicaCount": {
              "description": "Number of replicas",
              "type": "integer"
            },
            "resources": {
              "type": "object",
              "properties": {
                "limits": {
                  "type": "object",
                  "properties": {
                    "cpu": {
                      "description": "CPU limit",
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        }
                      ]
                    },
                    "memory": {
                      "description": "Memory limit",
                      "type": "string"
                    }
                  }
                },
                "requests": {
                  "type": "object",
                  "properties": {
                    "cpu": {
                      "description": "CPU request",
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        }
                      ]
                    },
                    "memory": {
                      "description": "Memory request",
                      "type": "string"
                    }
                  }
                }
              }
            },
            "skipAuth": {
              "description": "Paths to skip authentication",
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "method": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string"
                  }
                }
              }
            },
            "volumeMounts": {
              "description": "Volume mounts for the OIDC proxy",
              "type": "array"
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "enabled": {
              "description": "Enable persistence",
              "type": "boolean"
            },
            "existingClaim": {
              "description": "Existing PVC name",
              "type": "string"
            },
            "mountPath": {
              "description": "Mount path for the PVC",
              "type": "string"
            },
            "pvc": {
              "type": "object",
              "properties": {
                "accessModes": {
                  "description": "Access modes for the PVC",
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": [
                      "ReadWriteOnce",
                      "ReadOnlyMany",
                      "ReadWriteMany",
                      "ReadWriteOncePod"
                    ]
                  }
                },
                "dataSource": {
                  "type": "object",
                  "properties": {
                    "apiGroup": {
                      "description": "API version of the data source",
                      "type": "string"
                    },
                    "kind": {
                      "description": "Kind of the data source [VolumeSnapshot, PersistentVolumeClaim]",
                      "type": "string"
                    },
                    "name": {
                      "description": "Name of the data source",
                      "type": "string"
                    }
                  }
                },
                "resources": {
                  "type": "object",
                  "properties": {
                    "requests": {
                      "description": "PVC resource requests",
                      "type": "object",
                      "properties": {
                        "storage": {
                          "description": "Storage resource request",
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "storageClassName": {
                  "description": "Storage class name",
                  "type": "string"
                }
              }
            }
          }
        },
        "podAnnotations": {
          "description": "Annotations to add to pods",
          "type": "object",
          "properties": {
            "config.linkerd.io/skip-outbound-ports": {
              "description": "Linkerd skip outbound ports annotation",
              "type": "string"
            },
            "linkerd.io/inject": {
              "description": "Linkerd injection annotation",
              "type": "string"
            }
          }
        },
        "podLabels": {
          "description": "Global labels to add to all pods",
          "type": "object"
        },
        "podSecurityContext": {
          "description": "Pod security context",
          "type": "object"
        },
        "progressDeadlineSeconds": {
          "description": "the number of seconds the Deployment controller waits before indicating (in the Deployment status) that the Deployment progress has stalled",
          "type": "integer"
        },
        "readinessProbe": {
          "description": "Readiness probe configuration",
          "type": "object",
          "properties": {
            "failureThreshold": {
              "description": "Number of failures before the probe is considered failed",
              "type": "number"
            },
            "httpGet": {
              "description": "HTTP probe configuration (exec \u0026 tcpSocket are also available)",
              "type": "object",
              "properties": {
                "path": {
                  "description": "Path to probe",
                  "type": "string"
                },
                "port": {
                  "description": "Port to probe",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "number"
                    }
                  ]
                },
                "scheme": {
                  "description": "Scheme to use",
                  "type": "string"
                }
              }
            },
            "initialDelaySeconds": {
              "description": "Number of seconds after the container has started before the probe is first initiated",
              "type": "number"
            },
            "periodSeconds": {
              "description": "How often to perform the probe",
              "type": "number"
            },
            "successThreshold": {
              "description": "Number of successes before the probe is considered successful",
              "type": "number"
            },
            "timeoutSeconds": {
              "description": "Timeout for the probe",
              "type": "number"
            }
          }
        },
        "replicaCount": {
          "description": "Number of replicas",
          "type": "integer"
        },
        "resources": {
          "description": "Resource requests and limits for the primary container",
          "type": "object",
          "properties": {
            "limits": {
              "description": "Resource limits",
              "type": "object",
              "properties": {
                "cpu": {
                  "description": "CPU limit",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "number"
                    }
                  ]
                },
                "memory": {
                  "description": "Memory limit",
                  "type": "string"
                }
              }
            },
            "requests": {
              "description": "Resource requests",
              "type": "object",
              "properties": {
                "cpu": {
                  "description": "CPU request",
                  "oneOf": [
                    {
                      "type": "string"
                    },
                    {
                      "type": "number"
                    }
                  ]
                },
                "memory": {
                  "description": "Memory request",
                  "type": "string"
                }
              }
            }
          }
        },
        "restartPolicy": {
          "description": "Restart policy for the pod",
          "type": "string",
          "enum": [
            "Always",
            "OnFailure",
            "Never"
          ]
        },
        "s3Storage": {
          "type": "object",
          "properties": {
            "accessModes": {
              "description": "Access modes for the S3 storage",
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "ReadWriteOnce",
                  "ReadOnlyMany",
                  "ReadWriteMany",
                  "ReadWriteOncePod"
                ]
              }
            },
            "annotations": {
              "description": "Additional annotations for PV/PVC",
              "type": "object"
            },
            "bucketName": {
              "description": "S3 bucket name",
              "type": "string"
            },
            "capacity": {
              "description": "Storage capacity",
              "type": "string"
            },
            "enabled": {
              "description": "Enable S3 CSI storage",
              "type": "boolean"
            },
            "labels": {
              "description": "Additional labels for PV/PVC",
              "type": "object"
            },
            "namespace": {
              "description": "Namespace for PV/PVC (uses release namespace if empty)",
              "type": "string"
            },
            "pvName": {
              "description": "Custom PV name (auto-generated if empty)",
              "type": "string"
            },
            "pvcName": {
              "description": "Custom PVC name (auto-generated if empty)",
              "type": "string"
            },
            "reclaimPolicy": {
              "description": "Reclaim policy for the PV",
              "type": "string"
            },
            "region": {
              "description": "AWS region",
              "type": "string"
            },
            "volumeAttributes": {
              "description": "Additional CSI volume attributes",
              "type": "object"
            },
            "volumeHandle": {
              "description": "CSI volume handle (auto-generated if empty)",
              "type": "string"
            }
          }
        },
        "securityContext": {
          "description": "Security context",
          "type": "object"
        },
        "service": {
          "description": "Service configuration",
          "type": "object",
          "properties": {
            "port": {
              "description": "Service port",
              "type": "number"
            },
            "type": {
              "description": "Service type",
              "type": "string"
            }
          }
        },
        "serviceAccount": {
          "description": "Service account configuration",
          "type": "object",
          "properties": {
            "annotations": {
              "description": "Annotations to add to the service account",
              "type": "object"
            },
            "automount": {
              "description": "Specifies whether to automatically mount a ServiceAccount's API credentials",
              "type": "boolean"
            },
            "create": {
              "description": "Specifies whether a service account should be created",
              "type": "boolean"
            },
            "name": {
              "description": "Name of the service account to use (if not set and create is true, a name is generated using the fullname template)",
              "type": "string"
            }
          }
        },
        "shareProcessNamespace": {
          "description": "Share process namespace",
          "type": "boolean"
        },
        "sidecars": {
          "description": "List of sidecars",
          "type": "array"
        },
        "startupProbe": {
          "description": "Startup probe configuration",
          "type": "object",
          "properties": {
            "enabled": {
              "description": "Enable the startup probe",
              "type": "boolean"
            },
            "exec": {
              "description": "Exec probe configuration",
              "type": "object",
              "properties": {
                "command": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "failureThreshold": {
              "description": "Number of failures before the probe is considered failed",
              "type": "integer"
            },
            "initialDelaySeconds": {
              "description": "Number of seconds after the container has started before the probe is first initiated",
              "type": "integer"
            },
            "periodSeconds": {
              "description": "How often to perform the probe",
              "type": "integer"
            },
            "successThreshold": {
              "description": "Number of successes before the probe is considered successful",
              "type": "integer"
            },
            "timeoutSeconds": {
              "description": "Timeout for the probe",
              "type": "integer"
            }
          }
        },
        "tolerations": {
          "description": "Tolerations for the pod",
          "type": "array"
        },
        "topologySpreadConstraints": {
          "description": "Topology spread constraints for the pod",
          "type": "array"
        },
        "volumeMounts": {
          "description": "Additional volume mounts on the output Deployment definition",
          "type": "array"
        },
        "volumes": {
          "description": "Additional volumes on the output Deployment definition",
          "type": "array"
        }
      }
    },
    "jobs": {
      "description": "Jobs to deploy",
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "$ref": "#/properties/global",
          "type": "object"
        }
      }
    },
    "services": {
      "description": "Services to deploy",
      "type": "object",
      "patternProperties": {
        "^.*$": {
          "$ref": "#/properties/global",
          "type": "object",
          "unevaluatedProperties": false
        }
      }
    }
  }
}
