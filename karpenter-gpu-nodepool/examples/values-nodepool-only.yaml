# Example: Only deploy NodePool, skip NVIDIA driver
# Useful when the NVIDIA driver is already installed via a different method

nodepool:
  enabled: true
  name: gpu-workloads
  
  disruption:
    consolidationPolicy: WhenEmptyOrUnderutilized
    consolidateAfter: 30s
  
  template:
    metadata:
      labels:
        workload.type: gpu
        workload.node-purpose: gpu
    
    spec:
      expireAfter: 24h
      
      nodeClassRef:
        group: karpenter.k8s.aws
        kind: EC2NodeClass
        name: default
      
      startupTaints:
        - key: ebs.csi.aws.com/agent-not-ready
          effect: NoSchedule
        - key: efs.csi.aws.com/agent-not-ready
          effect: NoSchedule
      
      requirements:
        - key: kubernetes.io/arch
          operator: In
          values:
            - amd64
        - key: kubernetes.io/os
          operator: In
          values:
            - linux
        - key: karpenter.sh/capacity-type
          operator: In
          values:
            - on-demand
        - key: karpenter.k8s.aws/instance-family
          operator: In
          values:
            - g4dn
            - g5
            - g6
            - g6e
            - p3
            - p4d
            - p4de
            - p5
        - key: karpenter.k8s.aws/instance-gpu-count
          operator: NotIn
          values:
            - "0"
      
      taints:
        - key: workload.gpu
          value: "true"
          effect: NoSchedule

# Disable NVIDIA driver deployment
nvidiaDriver:
  enabled: false

